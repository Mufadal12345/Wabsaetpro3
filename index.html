<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุชุญู ุงูููุฑ - ุจูุงุจุฉ ุงูุฅุจุฏุงุน ุงูููุฑู ุงูุฑูููุฉ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&amp;family=Tajawal:wght@300;400;500;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'Tajawal', sans-serif;
    }
    .arabic-quote {
      font-family: 'Amiri', serif;
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .gradient-bg {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    .text-gradient {
      background: linear-gradient(135deg, #e94560, #f39c12, #e94560);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradient-shift 3s ease infinite;
    }
    @keyframes gradient-shift {
      0%, 100% { background-position: 0% center; }
      50% { background-position: 100% center; }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(233, 69, 96, 0.3); }
      50% { box-shadow: 0 0 40px rgba(233, 69, 96, 0.6); }
    }
    .pulse-glow {
      animation: pulse-glow 2s ease-in-out infinite;
    }
    .sidebar-item {
      transition: all 0.2s ease;
    }
    .sidebar-item:hover {
      background: rgba(233, 69, 96, 0.2);
      padding-right: 1.5rem;
    }
    .sidebar-item.active {
      background: rgba(233, 69, 96, 0.3);
      border-right: 3px solid #e94560;
    }
    .modal-overlay {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
    }
    .notification-badge {
      animation: bounce 1s ease infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    .tab-btn.active {
      background: linear-gradient(135deg, #e94560, #f39c12);
      color: white;
    }
    .idea-card {
      background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
      border: 1px solid rgba(255,255,255,0.1);
    }
    .category-badge {
      font-size: 0.7rem;
      padding: 0.2rem 0.6rem;
    }
    .stats-card {
      background: linear-gradient(145deg, rgba(233, 69, 96, 0.2), rgba(243, 156, 18, 0.1));
    }
    .loading-spinner {
      border: 3px solid rgba(255,255,255,0.1);
      border-top-color: #e94560;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .toast {
      animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeOut {
      to { opacity: 0; transform: translateX(100%); }
    }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .sidebar-hidden {
      transform: translateX(100%);
      opacity: 0;
      pointer-events: none;
    }
    .sidebar-visible {
      transform: translateX(0);
      opacity: 1;
      pointer-events: all;
    }
    #sidebar {
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
    }
    .menu-icon {
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .menu-icon:hover {
      transform: scale(1.1);
    }
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .fade-in-up {
      animation: fadeInUp 0.6s ease forwards;
    }
    .quote-card {
      background: linear-gradient(145deg, rgba(233, 69, 96, 0.15), rgba(243, 156, 18, 0.1));
      border-right: 4px solid #e94560;
    }
    .sync-indicator {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    .sync-success {
      background: rgba(34, 197, 94, 0.9);
      color: white;
    }
    .sync-syncing {
      background: rgba(59, 130, 246, 0.9);
      color: white;
    }
    .sync-error {
      background: rgba(239, 68, 68, 0.9);
      color: white;
    }
    .tag-input {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 0.75rem;
      border-radius: 0.75rem;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .tag {
      background: rgba(233, 69, 96, 0.3);
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .tag button {
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    .tag button:hover {
      opacity: 1;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full gradient-bg text-white overflow-auto">
  <div id="app" class="h-full"><!-- Sync Status Indicator -->
   <div id="sync-indicator" class="sync-indicator hidden"><span id="sync-icon">โณ</span> <span id="sync-text">ุฌุงุฑู ุงููุฒุงููุฉ...</span>
   </div><!-- Toast Container -->
   <div id="toast-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2"></div><!-- Loading Screen -->
   <div id="loading-screen" class="fixed inset-0 gradient-bg flex items-center justify-center z-50">
    <div class="text-center">
     <div class="loading-spinner mx-auto mb-4"></div>
     <p class="text-xl text-gray-300">๐ ุฌุงุฑู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช...</p>
     <p class="text-sm text-gray-400 mt-2">ูุชุญู ุงูููุฑ - ุงููุณุฎุฉ ุงููุญุฏุซุฉ</p>
    </div>
   </div><!-- Login Page -->
   <div id="login-page" class="hidden h-full flex items-center justify-center p-4">
    <div class="glass-effect rounded-3xl p-8 max-w-md w-full">
     <div class="text-center mb-8">
      <div class="text-6xl mb-4 float-animation">
       ๐๏ธ
      </div>
      <h1 id="login-title" class="text-3xl font-bold text-gradient mb-2">ูุชุญู ุงูููุฑ</h1>
      <p id="login-subtitle" class="text-gray-400">ุจูุงุจุฉ ุงูุฅุจุฏุงุน ุงูููุฑู ุงูุฑูููุฉ</p>
      <p class="text-xs text-green-400 mt-2">โ ูุชุตู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช</p>
     </div>
     <form id="login-form" class="space-y-6">
      <div><label for="login-name" class="block text-sm font-medium mb-2 text-gray-300">ุงูุงุณู</label> <input type="text" id="login-name" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500 transition" placeholder="ุฃุฏุฎู ุงุณูู">
      </div>
      <div><label for="login-specialty" class="block text-sm font-medium mb-2 text-gray-300">ุงูุชุฎุตุต</label> <input type="text" id="login-specialty" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500 transition" placeholder="ุฃุฏุฎู ุชุฎุตุตู">
      </div><button type="submit" id="login-btn" class="w-full py-4 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 text-white font-bold text-lg hover:opacity-90 transition pulse-glow"> ๐ ุฏุฎูู ุงููุชุญู </button>
     </form>
     <p id="login-welcome" class="text-center text-gray-500 text-sm mt-6">ุญูุซ ุชุชุญูู ุงูุฃููุงุฑ ุฅูู ุฅุฑุซ ุฎุงูุฏ</p>
    </div>
   </div><!-- Main Dashboard -->
   <div id="dashboard" class="hidden h-full flex relative"><!-- Menu Toggle Button --> <button id="menu-toggle" class="fixed top-6 right-6 z-40 w-14 h-14 rounded-full glass-effect flex items-center justify-center menu-icon"> <span class="text-2xl">๐๏ธ</span> </button> <!-- Sidebar -->
    <aside id="sidebar" class="fixed left-0 top-0 h-full w-64 glass-effect border-l border-white/10 flex flex-col z-30 sidebar-hidden">
     <div class="p-6 border-b border-white/10">
      <div class="flex items-center gap-3"><span class="text-3xl">๐๏ธ</span>
       <div>
        <h2 id="sidebar-title" class="font-bold text-lg">ูุชุญู ุงูููุฑ</h2>
        <p class="text-xs text-gray-400">ููุญุฉ ุงูุชุญูู</p>
       </div>
      </div>
     </div>
     <nav class="flex-1 p-4 space-y-2 overflow-auto"><button onclick="navigateTo('home')" class="sidebar-item active w-full text-right px-4 py-3 rounded-xl flex items-center gap-3" data-section="home"> <span>๐</span> <span>ุงูุฑุฆูุณูุฉ</span> </button> <button onclick="navigateTo('ideas')" class="sidebar-item w-full text-right px-4 py-3 rounded-xl flex items-center gap-3" data-section="ideas"> <span>๐ก</span> <span>ุงูุฃููุงุฑ</span> </button> <button onclick="navigateTo('trending')" class="sidebar-item w-full text-right px-4 py-3 rounded-xl flex items-center gap-3" data-section="trending"> <span>๐ฅ</span> <span>ุงูุฃูุซุฑ ุฑูุงุฌุงู</span> </button> <button onclick="navigateTo('content')" class="sidebar-item w-full text-right px-4 py-3 rounded-xl flex items-center gap-3" data-section="content"> <span>๐</span> <span>ุงููุญุชูู</span> </button> <button onclick="navigateTo('philosophy')" class="sidebar-item w-full text-right px-4 py-3 rounded-xl flex items-center gap-3" data-section="philosophy"> <span>๐ง</span> <span>ุงูููุณูุฉ</span> </button> <button onclick="navigateTo('quotes')" class="sidebar-item w-full text-right px-4 py-3 rounded-xl flex items-center gap-3" data-section="quotes"> <span>โจ</span> <span>ุนุจุงุฑุงุช ููููุฉ</span> </button> <button onclick="navigateTo('search')" class="sidebar-item w-full text-right px-4 py-3 rounded-xl flex items-center gap-3" data-section="search"> <span>๐</span> <span>ุงูุจุญุซ</span> </button> <button onclick="navigateTo('members')" id="members-btn" class="sidebar-item w-full text-right px-4 py-3 rounded-xl flex items-center gap-3 hidden" data-section="members"> <span>๐ฅ</span> <span>ุงูุฃุนุถุงุก</span> </button> <button onclick="navigateTo('suggestions')" id="suggestions-btn" class="sidebar-item w-full text-right px-4 py-3 rounded-xl flex items-center gap-3 relative" data-section="suggestions"> <span>๐</span> <span>ุงูุงูุชุฑุงุญุงุช</span> <span id="suggestions-badge" class="hidden absolute left-2 bg-pink-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center notification-badge">0</span> </button> <button onclick="navigateTo('invites')" id="invites-btn" class="sidebar-item w-full text-right px-4 py-3 rounded-xl flex items-center gap-3 hidden" data-section="invites"> <span>๐ซ</span> <span>ุฑููุฒ ุงูุฏุนูุฉ</span> </button> <button onclick="navigateTo('settings')" id="settings-btn" class="sidebar-item w-full text-right px-4 py-3 rounded-xl flex items-center gap-3 hidden" data-section="settings"> <span>โ๏ธ</span> <span>ุงูุฅุนุฏุงุฏุงุช</span> </button>
     </nav>
     <div class="p-4 border-t border-white/10">
      <div class="flex items-center gap-3 mb-3">
       <div class="w-10 h-10 rounded-full bg-gradient-to-r from-pink-600 to-orange-500 flex items-center justify-center text-lg"><span id="user-avatar">๐ค</span>
       </div>
       <div class="flex-1">
        <p id="user-name" class="font-medium text-sm truncate">ูุณุชุฎุฏู</p>
        <p id="user-specialty" class="text-xs text-gray-400 truncate">ุชุฎุตุต</p>
       </div>
      </div><button onclick="logout()" class="w-full py-2 rounded-lg bg-white/10 hover:bg-red-500/30 transition text-sm"> ๐ช ุชุณุฌูู ุงูุฎุฑูุฌ </button>
     </div>
    </aside><!-- Main Content -->
    <main id="main-content" class="flex-1 overflow-auto p-6"><!-- Home Section -->
     <section id="home-section" class="space-y-6 max-w-7xl mx-auto">
      <div class="flex justify-between items-center flex-wrap gap-4 mb-8">
       <div>
        <h1 class="text-4xl font-bold mb-2">ูุฑุญุจุงู ุจู ูู ูุชุญู ุงูููุฑ ๐๏ธ</h1>
        <p class="text-gray-400">ุงูุชุดู ุงูุฃููุงุฑ ูุดุงุฑู ุฅุจุฏุงุนุงุชู</p>
       </div><button onclick="openModal('add-idea')" id="add-idea-home-btn" class="px-6 py-3 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 hover:opacity-90 transition flex items-center gap-2"> <span>โจ</span> <span>ููุฑุฉ ุฌุฏูุฏุฉ</span> </button>
      </div><!-- Featured Quote -->
      <div class="quote-card rounded-2xl p-8 mb-8 fade-in-up">
       <div class="text-5xl mb-4 text-center">
        ๐
       </div>
       <p class="arabic-quote text-2xl text-center mb-4 leading-relaxed">"ุงูููุฑุฉ ูู ุงูุจุฐุฑุฉุ ูุงูุนูู ูู ุงูุชุฑุจุฉุ ูุงูุฅุจุฏุงุน ูู ุงูุซูุฑุฉ"</p>
       <p class="text-center text-gray-400">โ ูู ุญูู ูุชุญู ุงูููุฑ</p>
      </div><!-- Stats Cards (Admin Only) -->
      <div id="admin-stats-section" class="hidden grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
       <div class="stats-card rounded-2xl p-6 glass-effect card-hover">
        <div class="text-4xl mb-2">
         ๐ก
        </div>
        <p class="text-3xl font-bold" id="stats-ideas">0</p>
        <p class="text-gray-400 text-sm">ููุฑุฉ ูุณุฌูุฉ</p>
       </div>
       <div class="stats-card rounded-2xl p-6 glass-effect card-hover">
        <div class="text-4xl mb-2">
         ๐ฅ
        </div>
        <p class="text-3xl font-bold" id="stats-members">0</p>
        <p class="text-gray-400 text-sm">ุนุถู ูุดุท</p>
       </div>
       <div class="stats-card rounded-2xl p-6 glass-effect card-hover">
        <div class="text-4xl mb-2">
         ๐๏ธ
        </div>
        <p class="text-3xl font-bold" id="stats-views">0</p>
        <p class="text-gray-400 text-sm">ูุดุงูุฏุฉ</p>
       </div>
       <div class="stats-card rounded-2xl p-6 glass-effect card-hover">
        <div class="text-4xl mb-2">
         โญ
        </div>
        <p class="text-3xl font-bold" id="stats-featured">0</p>
        <p class="text-gray-400 text-sm">ููุฑุฉ ูููุฒุฉ</p>
       </div>
      </div><!-- Recent Ideas -->
      <div class="glass-effect rounded-2xl p-6">
       <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">ุฃุญุฏุซ ุงูุฃููุงุฑ ๐ก</h2><button onclick="navigateTo('ideas')" class="text-pink-500 hover:underline text-sm">ุนุฑุถ ุงููู โ</button>
       </div>
       <div id="recent-ideas" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <p class="text-gray-400 col-span-full text-center py-8">ูุง ุชูุฌุฏ ุฃููุงุฑ ุจุนุฏ. ูู ุฃูู ูู ูุดุงุฑู!</p>
       </div>
      </div>
     </section><!-- Ideas Section -->
     <section id="ideas-section" class="hidden space-y-6 max-w-7xl mx-auto">
      <div class="flex justify-between items-center flex-wrap gap-4">
       <div>
        <h1 class="text-3xl font-bold">ูุนุฑุถ ุงูุฃููุงุฑ ๐ก</h1>
        <p class="text-gray-400 mt-1">ุงูุชุดู ุงูุฅุจุฏุงุนุงุช ุงูููุฑูุฉ ููุฃุนุถุงุก</p>
       </div><button onclick="openModal('add-idea')" id="add-idea-btn" class="px-6 py-3 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 hover:opacity-90 transition flex items-center gap-2"> <span>โจ</span> <span>ุฃุถู ููุฑุชู</span> </button>
      </div><!-- Filter Tabs -->
      <div class="flex gap-2 flex-wrap"><button onclick="filterIdeas('all')" class="tab-btn active px-4 py-2 rounded-full bg-white/10 hover:bg-white/20 transition text-sm">ุงููู</button> <button onclick="filterIdeas('ุชูููุฉ')" class="tab-btn px-4 py-2 rounded-full bg-white/10 hover:bg-white/20 transition text-sm">ุชูููุฉ</button> <button onclick="filterIdeas('ููุฑูุฉ')" class="tab-btn px-4 py-2 rounded-full bg-white/10 hover:bg-white/20 transition text-sm">ููุฑูุฉ</button> <button onclick="filterIdeas('ุฅุจุฏุงุนูุฉ')" class="tab-btn px-4 py-2 rounded-full bg-white/10 hover:bg-white/20 transition text-sm">ุฅุจุฏุงุนูุฉ</button> <button onclick="filterIdeas('ุนูููุฉ')" class="tab-btn px-4 py-2 rounded-full bg-white/10 hover:bg-white/20 transition text-sm">ุนูููุฉ</button>
      </div><!-- Ideas Grid -->
      <div id="ideas-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
       <p class="text-gray-400 col-span-full text-center py-12">ูุง ุชูุฌุฏ ุฃููุงุฑ ูู ูุฐุง ุงููุณู ุจุนุฏ</p>
      </div>
     </section><!-- Trending Section -->
     <section id="trending-section" class="hidden space-y-6 max-w-7xl mx-auto">
      <div>
       <h1 class="text-3xl font-bold mb-2">ุงูุฃูุซุฑ ุฑูุงุฌุงู ๐ฅ</h1>
       <p class="text-gray-400">ุงูุฃููุงุฑ ุงูุฃูุซุฑ ุชูุงุนูุงู ููุดุงูุฏุฉ</p>
      </div>
      <div id="trending-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
       <p class="text-gray-400 col-span-full text-center py-12">ูุง ุชูุฌุฏ ุฃููุงุฑ ุฑุงุฆุฌุฉ ุจุนุฏ</p>
      </div>
     </section><!-- Search Section -->
     <section id="search-section" class="hidden space-y-6 max-w-5xl mx-auto">
      <div>
       <h1 class="text-3xl font-bold mb-2">ุงูุจุญุซ ๐</h1>
       <p class="text-gray-400">ุงุจุญุซ ุนู ุงูุฃููุงุฑ ูุงููุญุชูู</p>
      </div>
      <div class="glass-effect rounded-2xl p-6"><input type="text" id="search-input" class="w-full px-6 py-4 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500 text-lg" placeholder="ุงุจุญุซ ุนู ุฃููุงุฑุ ูููุงุช ููุชุงุญูุฉุ ุฃู ูุคูููู...">
      </div>
      <div id="search-results" class="space-y-4">
       <p class="text-gray-400 text-center py-12">ุงุจุฏุฃ ุงูุจุญุซ ูุฅูุฌุงุฏ ุงูุฃููุงุฑ...</p>
      </div>
     </section><!-- Content Section -->
     <section id="content-section" class="hidden space-y-6 max-w-5xl mx-auto">
      <div>
       <h1 class="text-3xl font-bold mb-2">ุงููุญุชูู ุงูููุฑู ๐</h1>
       <p class="text-gray-400">ููุงูุงุช ููุตูุต ููุฑูุฉ ููููุฉ</p>
      </div>
      <div class="space-y-6"><!-- Article 1 -->
       <div class="glass-effect rounded-2xl p-8 card-hover">
        <div class="flex items-start gap-4 mb-4">
         <div class="text-4xl">
          ๐
         </div>
         <div>
          <h2 class="text-2xl font-bold mb-2">ููุฉ ุงูููุฑุฉ ูู ุชุบููุฑ ุงููุงูุน</h2>
          <p class="text-sm text-gray-400">ููุงูุฉ ููุฑูุฉ</p>
         </div>
        </div>
        <p class="text-gray-300 leading-relaxed mb-4">ุงูุฃููุงุฑ ูู ุงูุจุฐูุฑ ุงูุชู ุชูุจุช ูู ุนููููุง ูุชุตุจุญ ูุงูุนุงู ูุนูุดู. ูู ุงุฎุชุฑุงุน ุนุธููุ ูู ุญุฑูุฉ ุชุบููุฑุ ูู ุซูุฑุฉ ุญุถุงุฑูุฉุ ุจุฏุฃุช ุจููุฑุฉ ุจุณูุทุฉ ูู ุนูู ุฅูุณุงู ูุงุญุฏ. ููู ุงูููุฑุฉ ูุญุฏูุง ูุง ุชูููุ ููู ุชุญุชุงุฌ ุฅูู ุงูุนุฒููุฉ ูุงูุฅุตุฑุงุฑ ูุงูุนูู ุงูุฌุงุฏ ูุชุชุญูู ูู ุฎูุงู ุฅูู ุญูููุฉ ููููุณุฉ ุชุคุซุฑ ูู ุญูุงุฉ ุงูููุงููู.</p>
        <p class="text-gray-300 leading-relaxed">ูู ูุฐุง ุงููุชุญูุ ูุคูู ุจุฃู ูู ููุฑุฉ ุชุณุชุญู ุฃู ุชูุณูุนุ ููู ุตูุช ูุณุชุญู ุฃู ููุณูุน. ูุญู ููุง ููููุฑ ุงููุณุงุญุฉ ุงูุขููุฉ ุญูุซ ูููู ููุฃููุงุฑ ุฃู ุชููู ูุชุฒุฏูุฑุ ุญูุซ ูููู ููุนููู ุฃู ุชูุชูู ูุชุชุญุงูุฑุ ูุญูุซ ูููู ููุฅุจุฏุงุน ุฃู ูุฌุฏ ุทุฑููู ุฅูู ุงูููุฑ.</p>
       </div><!-- Article 2 -->
       <div class="glass-effect rounded-2xl p-8 card-hover">
        <div class="flex items-start gap-4 mb-4">
         <div class="text-4xl">
          ๐
         </div>
         <div>
          <h2 class="text-2xl font-bold mb-2">ุงูุฅุจุฏุงุน: ุฑุญูุฉ ูุง ูุฌูุฉ</h2>
          <p class="text-sm text-gray-400">ุชุฃููุงุช ุฅุจุฏุงุนูุฉ</p>
         </div>
        </div>
        <p class="text-gray-300 leading-relaxed mb-4">ุงูุฅุจุฏุงุน ููุณ ุญุฏุซุงู ูุญุฏุซ ูุฑุฉ ูุงุญุฏุฉุ ุจู ูู ุฑุญูุฉ ูุณุชูุฑุฉ ูู ุงูุงุณุชูุดุงู ูุงูุชุฌุฑูุจ ูุงูุชุนูู. ูู ุฎุทูุฉ ูู ูุฐู ุงูุฑุญูุฉ ุชูุชุญ ุฃุจูุงุจุงู ุฌุฏูุฏุฉ ูู ุงูุฅููุงููุงุชุ ููู ุชุฌุฑุจุฉ - ุณูุงุก ูุฌุญุช ุฃู ูุดูุช - ุชุถูู ุฅูู ุฎุจุฑุชูุง ูุชูุณุน ุขูุงููุง.</p>
        <p class="text-gray-300 leading-relaxed">ุงููุจุฏุนูู ุงูุญูููููู ูู ุฃููุฆู ุงูุฐูู ูุง ูุฎุงููู ุงููุดูุ ุจู ูุฑููู ูุฑุตุฉ ููุชุนูู ูุงูููู. ูู ุงูุฐูู ูุฌุฑุคูู ุนูู ุงูุชูููุฑ ุฎุงุฑุฌ ุงูุตูุฏููุ ูุงูุฐูู ูุคูููู ุจุฃู ูุง ุดูุก ูุณุชุญูู ุทุงููุง ุชููุฑุช ุงูุฅุฑุงุฏุฉ ูุงูุนุฒููุฉ.</p>
       </div><!-- Article 3 -->
       <div class="glass-effect rounded-2xl p-8 card-hover">
        <div class="flex items-start gap-4 mb-4">
         <div class="text-4xl">
          ๐จ
         </div>
         <div>
          <h2 class="text-2xl font-bold mb-2">ุงูุชููุน ุงูููุฑู: ุซุฑุงุก ุงูุญุถุงุฑุฉ</h2>
          <p class="text-sm text-gray-400">ุฑุคูุฉ ุซูุงููุฉ</p>
         </div>
        </div>
        <p class="text-gray-300 leading-relaxed mb-4">ุงูุชููุน ุงูููุฑู ูู ูุง ูุฌุนู ุงูุญุถุงุฑุงุช ุบููุฉ ููุฒุฏูุฑุฉ. ุนูุฏูุง ุชูุชูู ุงูุฃููุงุฑ ุงููุฎุชููุฉุ ุนูุฏูุง ุชุชุตุงุฏู ูุฌูุงุช ุงููุธุฑ ุงููุชุจุงููุฉุ ุนูุฏูุง ูุญุงูุฑ ุงูุนูู ุงูููุฏู ุงูุนูู ุงูุฅุจุฏุงุนู - ูู ุชูู ุงููุญุธุงุช ุชููุฏ ุงูุญููู ุงููุจุชูุฑุฉ ูุงูุฃููุงุฑ ุงูุซูุฑูุฉ.</p>
        <p class="text-gray-300 leading-relaxed">ูู ูุชุญู ุงูููุฑุ ูุญุชูู ุจูุฐุง ุงูุชููุน. ูุคูู ุจุฃู ูู ุตูุช ูููุ ูุฃู ูู ูุฌูุฉ ูุธุฑ ุชุถูู ุจูุนุฏุงู ุฌุฏูุฏุงู ูููููุง ุงูุฌูุงุนู. ููุงุ ุงูุงุฎุชูุงู ููุณ ุนุงุฆูุงู ุจู ูู ููุฉ ุฏุงูุนุฉ ูุญู ุงูุงุจุชูุงุฑ ูุงูุชุทูุฑ.</p>
       </div>
      </div>
     </section><!-- Philosophy Section -->
     <section id="philosophy-section" class="hidden space-y-6 max-w-5xl mx-auto">
      <div>
       <h1 class="text-3xl font-bold mb-2">ุงูููุณูุฉ ูุงูุชุฃูู ๐ง</h1>
       <p class="text-gray-400">ุฃุณุฆูุฉ ุนูููุฉ ูุชุฃููุงุช ููุณููุฉ</p>
      </div>
      <div class="space-y-6"><!-- Philosophy 1 -->
       <div class="glass-effect rounded-2xl p-8 card-hover">
        <div class="text-center mb-6">
         <div class="text-5xl mb-4">
          ๐ค
         </div>
         <h2 class="text-2xl font-bold arabic-quote">ูุง ูู ุงูููุฑุฉุ</h2>
        </div>
        <div class="space-y-4 text-gray-300 leading-relaxed">
         <p>ุงูููุฑุฉ ูู ุฃุตุบุฑ ูุญุฏุฉ ูู ุงููุนูู ูููู ููุนูู ุฃู ูุณุชูุนุจูุง. ูู ุงูุดุฑุงุฑุฉ ุงูุฃููู ุงูุชู ุชุดุนู ูุงุฑ ุงูุชุบููุฑ. ููู ูุง ุงูุฐู ูุฌุนู ููุฑุฉ ูุง ุนุธููุฉุ ูู ูู ุงูุฃุตุงูุฉุ ุงูุชุฃุซูุฑุ ุงููุฏุฑุฉ ุนูู ุงูุจูุงุกุ</p>
         <p class="pr-6 border-r-4 border-pink-600">ุฑุจูุง ุงูุนุธูุฉ ูู ุงูููุฑุฉ ููุณุช ูู ุงูููุฑุฉ ุฐุงุชูุงุ ุจู ูู ูุฏุฑุชูุง ุนูู ุฅููุงุธ ุฃููุงุฑ ุฃุฎุฑู ูู ุนููู ุฃุฎุฑู. ุงูููุฑุฉ ุงูุนุธููุฉ ูู ุชูู ุงูุชู ุชูุชุดุฑุ ุชุชุทูุฑุ ูุชููู ุงูุขุฎุฑูู ูุฅูุชุงุฌ ุฃููุงุฑ ุฌุฏูุฏุฉ.</p>
        </div>
       </div><!-- Philosophy 2 -->
       <div class="glass-effect rounded-2xl p-8 card-hover">
        <div class="text-center mb-6">
         <div class="text-5xl mb-4">
          โ๏ธ
         </div>
         <h2 class="text-2xl font-bold arabic-quote">ุงูุญุฑูุฉ ูุงููุณุคูููุฉ</h2>
        </div>
        <div class="space-y-4 text-gray-300 leading-relaxed">
         <p>ูุน ุญุฑูุฉ ุงูุชูููุฑ ุชุฃุชู ูุณุคูููุฉ ุงูุชูููุฑ ุงูููุฏู. ูู ููุฑุฉ ูุชุจูุงูุงุ ูู ูุนุชูุฏ ูุญูููุ ูู ุชุฃุซูุฑ ุนูู ุญูุงุชูุง ูุญูุงุฉ ูู ุญูููุง. ูุฐุงุ ูุฅู ุงูุชูููุฑ ุงูุนููู ููุณ ุฑูุงููุฉ ููุฑูุฉุ ุจู ูู ูุงุฌุจ ุฃุฎูุงูู.</p>
         <p class="pr-6 border-r-4 border-pink-600">ุงูุณุคุงู ููุณ "ูุงุฐุง ุฃููุฑุ" ุจู "ููุงุฐุง ุฃููุฑ ููุฐุงุ" ู "ูุง ูู ุงูุฃุฏูุฉ ุงูุชู ุชุฏุนู ูุฐุง ุงูุชูููุฑุ" ุงูุชูููุฑ ุงูููุฏู ูู ุงูุฌุณุฑ ุจูู ุงูุญุฑูุฉ ูุงููุณุคูููุฉ.</p>
        </div>
       </div><!-- Philosophy 3 -->
       <div class="glass-effect rounded-2xl p-8 card-hover">
        <div class="text-center mb-6">
         <div class="text-5xl mb-4">
          ๐
         </div>
         <h2 class="text-2xl font-bold arabic-quote">ุงูููุฑ ูุงููุงูุน</h2>
        </div>
        <div class="space-y-4 text-gray-300 leading-relaxed">
         <p>ูู ุงูุฃููุงุฑ ุชุดูู ุงููุงูุน ุฃู ุงููุงูุน ูุดูู ุงูุฃููุงุฑุ ูุฐุง ุงูุณุคุงู ุงูููุณูู ุงููุฏูู ูู ุฅุฌุงุจุฉ ุนูููุฉ: ููุงููุง ุตุญูุญ. ูุญู ูุชุฃุซุฑ ุจูุงูุนูุง ููููุฑ ุจุทุฑู ูุนููุฉุ ุซู ูุณุชุฎุฏู ุฃููุงุฑูุง ูุชุบููุฑ ูุฐุง ุงููุงูุน.</p>
         <p class="pr-6 border-r-4 border-pink-600">ุงููููุฑ ุงูุญูููู ูู ูู ูุฏุฑู ูุฐู ุงูุนูุงูุฉ ุงูุฌุฏููุฉ ููุณุชุฎุฏููุง ุจูุนู. ูู ูู ููุธุฑ ุฅูู ุงููุงูุน ุจุนูู ูุงูุฏุฉุ ุซู ูุณุชุฎุฏู ููุฉ ุงูููุฑ ูุชุฎูู ูุงูุน ุฃูุถูุ ูุฃุฎูุฑุงู ูุนูู ุนูู ุชุญููู ูุฐุง ุงูุชุฎูู ุฅูู ุญูููุฉ.</p>
        </div>
       </div><!-- Philosophy 4 -->
       <div class="glass-effect rounded-2xl p-8 card-hover">
        <div class="text-center mb-6">
         <div class="text-5xl mb-4">
          ๐ญ
         </div>
         <h2 class="text-2xl font-bold arabic-quote">ูููุฉ ุงูุตูุช</h2>
        </div>
        <div class="space-y-4 text-gray-300 leading-relaxed">
         <p>ูู ุนุงูู ูููุก ุจุงูุถุฌูุฌ ูุงูุขุฑุงุก ุงููุชุณุงุฑุนุฉุ ุงูุตูุช ุฃุตุจุญ ูุถููุฉ ูุงุฏุฑุฉ. ููู ุงูุตูุช ููุณ ุบูุงุจุงู ููููุฑุ ุจู ูู ุญุถูุฑ ููุซู ูู. ูู ุงูุตูุชุ ูุณุชุทูุน ุฃู ูุณูุน ุตูุชูุง ุงูุฏุงุฎููุ ุฃู ูุฑุชุจ ุฃููุงุฑูุงุ ูุฃู ูุตู ุฅูู ุฃุนูุงู ุฃุนูู ูู ุงูููู.</p>
         <p class="pr-6 border-r-4 border-pink-600">ูุจู ุฃู ุชุดุงุฑู ููุฑุชู ูุน ุงูุนุงููุ ุงููุญูุง ูุญุธุงุช ูู ุงูุตูุช. ุฏุนูุง ุชูุถุฌ ูู ุนูููุ ุชุชุจููุฑ ูุชุชุถุญ. ุงูุฃููุงุฑ ุงูุนุธููุฉ ููุณุช ุชูู ุงูุชู ูููููุง ุจุณุฑุนุฉุ ุจู ุชูู ุงูุชู ูุญุชูุธ ุจูุง ุญุชู ุชุตุจุญ ุฌุงูุฒุฉ ููููุงุฏุฉ.</p>
        </div>
       </div>
      </div>
     </section><!-- Quotes Section -->
     <section id="quotes-section" class="hidden space-y-6 max-w-5xl mx-auto">
      <div>
       <h1 class="text-3xl font-bold mb-2">ุนุจุงุฑุงุช ููููุฉ โจ</h1>
       <p class="text-gray-400">ูููุงุช ุชุถูุก ุงูุนูู ูุชุญุฑู ุงูููุจ</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!-- Quote 1 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         ๐ก
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ุงูุนูู ูุงููุธูุฉุ ูุง ูุนูู ุฅูุง ุฅุฐุง ูุงู ููุชูุญุงู"</p>
        <p class="text-center text-gray-400 text-sm">โ ุญููุฉ ุดุนุจูุฉ</p>
       </div><!-- Quote 2 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         ๐
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ุฃูุง ุฃููุฑุ ุฅุฐู ุฃูุง ููุฌูุฏ"</p>
        <p class="text-center text-gray-400 text-sm">โ ุฑูููู ุฏููุงุฑุช</p>
       </div><!-- Quote 3 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         ๐จ
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ุงูุฎูุงู ุฃูู ูู ุงููุนุฑูุฉุ ูุงููุนุฑูุฉ ูุญุฏูุฏุฉ ุจูููุง ุงูุฎูุงู ููุญูุท ุจุงูุนุงูู"</p>
        <p class="text-center text-gray-400 text-sm">โ ุฃูุจุฑุช ุฃููุดุชุงูู</p>
       </div><!-- Quote 4 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         ๐
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ุงููุฑุงุกุฉ ุชููุญ ุงูุฅูุณุงู ุญููุงุช ูุชุนุฏุฏุฉ ูู ุญูุงุฉ ูุงุญุฏุฉ"</p>
        <p class="text-center text-gray-400 text-sm">โ ูู ุญูู ุงูุฃุฏุจ</p>
       </div><!-- Quote 5 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         ๐ฅ
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ุงูููุฑุฉ ุงูุชู ูุง ุชุชุญูู ุฅูู ูุนูุ ููุณุช ุฃูุซุฑ ูู ุญูู"</p>
        <p class="text-center text-gray-400 text-sm">โ ุญููุฉ ุนูููุฉ</p>
       </div><!-- Quote 6 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         ๐ฑ
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ุงููุนุฑูุฉ ููุฉุ ูููู ุงูุชุทุจูู ูู ุงูุณูุทุงู"</p>
        <p class="text-center text-gray-400 text-sm">โ ูุฑุงูุณูุณ ุจูููู</p>
       </div><!-- Quote 7 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         ๐ฏ
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ุงููุฌุงุญ ููุณ ููุงูุฉุ ูุงููุดู ููุณ ูุงุชูุงูุ ุฅููุง ุงูุดุฌุงุนุฉ ุนูู ุงูุงุณุชูุฑุงุฑ ูู ุงูุชู ุชุญุณุจ"</p>
        <p class="text-center text-gray-400 text-sm">โ ูููุณุชูู ุชุดุฑุดู</p>
       </div><!-- Quote 8 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         ๐ฆ
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ุงูุชุบููุฑ ูุจุฏุฃ ูู ุงูุฏุงุฎูุ ููููู ูุญู ุงูุฎุงุฑุฌ"</p>
        <p class="text-center text-gray-400 text-sm">โ ูู ุญูู ุงูุชุทูุฑ ุงูุฐุงุชู</p>
       </div><!-- Quote 9 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         ๐
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ูู ูุงููุงุกุ ูุฑูุงู ููููุงู ูู ุขู ูุงุญุฏ"</p>
        <p class="text-center text-gray-400 text-sm">โ ุจุฑูุณ ูู</p>
       </div><!-- Quote 10 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         โจ
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ุงูุฅุจุฏุงุน ูู ุงูุฐูุงุก ููู ูุณุชูุชุน"</p>
        <p class="text-center text-gray-400 text-sm">โ ุฃูุจุฑุช ุฃููุดุชุงูู</p>
       </div><!-- Quote 11 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         ๐ญ
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ุงูุญูุงุฉ ุฅูุง ูุบุงูุฑุฉ ุฌุฑูุฆุฉ ุฃู ูุง ุดูุก"</p>
        <p class="text-center text-gray-400 text-sm">โ ููููู ูููุฑ</p>
       </div><!-- Quote 12 -->
       <div class="quote-card rounded-2xl p-6 card-hover">
        <div class="text-4xl mb-4 text-center">
         ๐๏ธ
        </div>
        <p class="arabic-quote text-xl text-center mb-4 leading-relaxed">"ุงูููุฉ ููุณุช ุงููุฏูุ ุจู ุงูุฑุญูุฉ ุฅูููุง"</p>
        <p class="text-center text-gray-400 text-sm">โ ูู ุญูู ุงููุณุงูุฑูู</p>
       </div>
      </div>
     </section><!-- Members Section (Admin Only) -->
     <section id="members-section" class="hidden space-y-6 max-w-7xl mx-auto">
      <div>
       <h1 class="text-3xl font-bold">ุฃุนุถุงุก ุงููุชุญู ๐ฅ</h1>
       <p class="text-gray-400 mt-1">ุชุนุฑู ุนูู ุงููููุฑูู ูุงููุจุฏุนูู</p>
      </div>
      <div id="members-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
       <p class="text-gray-400 col-span-full text-center py-12">ูุง ููุฌุฏ ุฃุนุถุงุก ูุณุฌููู ุจุนุฏ</p>
      </div>
     </section><!-- Suggestions Section -->
     <section id="suggestions-section" class="hidden space-y-6 max-w-5xl mx-auto">
      <div class="flex justify-between items-center flex-wrap gap-4">
       <div>
        <h1 class="text-3xl font-bold">ุตูุฏูู ุงูุงูุชุฑุงุญุงุช ๐</h1>
        <p class="text-gray-400 mt-1">ุดุงุฑููุง ุฃููุงุฑู ูุชุทููุฑ ุงููุชุญู</p>
       </div><button onclick="openModal('add-suggestion')" id="add-suggestion-btn" class="px-6 py-3 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 hover:opacity-90 transition flex items-center gap-2"> <span>๐ก</span> <span>ุงูุชุฑุงุญ ุฌุฏูุฏ</span> </button>
      </div>
      <div id="suggestions-list" class="space-y-4">
       <p class="text-gray-400 text-center py-12">ูุง ุชูุฌุฏ ุงูุชุฑุงุญุงุช ุจุนุฏ. ูู ุฃูู ูู ููุชุฑุญ!</p>
      </div>
     </section><!-- Invites Section (Admin Only) -->
     <section id="invites-section" class="hidden space-y-6 max-w-5xl mx-auto">
      <div class="flex justify-between items-center flex-wrap gap-4">
       <div>
        <h1 class="text-3xl font-bold">ุฑููุฒ ุงูุฏุนูุฉ ๐ซ</h1>
        <p class="text-gray-400 mt-1">ุฅูุดุงุก ูุฅุฏุงุฑุฉ ุฑููุฒ ุงูุฏุนูุฉ ููุฃุนุถุงุก</p>
       </div><button onclick="generateInviteCode()" class="px-6 py-3 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 hover:opacity-90 transition flex items-center gap-2"> <span>โ</span> <span>ุฅูุดุงุก ุฑูุฒ ุฌุฏูุฏ</span> </button>
      </div>
      <div id="invites-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
       <p class="text-gray-400 col-span-full text-center py-12">ูุง ุชูุฌุฏ ุฑููุฒ ุฏุนูุฉ ุจุนุฏ</p>
      </div>
     </section><!-- Settings Section (Admin Only) -->
     <section id="settings-section" class="hidden space-y-6 max-w-5xl mx-auto">
      <div>
       <h1 class="text-3xl font-bold">ุฅุนุฏุงุฏุงุช ุงููุชุญู โ๏ธ</h1>
       <p class="text-gray-400 mt-1">ุฅุฏุงุฑุฉ ูุชุฎุตูุต ุงููุชุญู</p>
      </div>
      <div class="glass-effect rounded-2xl p-6 space-y-6">
       <div>
        <h3 class="text-xl font-bold mb-4">ุญุงูุฉ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช</h3>
        <div id="db-status" class="p-4 rounded-xl bg-green-500/20 text-green-400 flex items-center gap-3"><span class="text-2xl">โ</span>
         <div>
          <p class="font-bold">ูุชุตู ุจูุฌุงุญ</p>
          <p class="text-sm opacity-80">Supabase Database</p>
         </div>
        </div>
       </div>
       <div class="border-t border-white/10 pt-6">
        <h3 class="text-xl font-bold mb-4">ุฅุฏุงุฑุฉ ุงููุญุชูู</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><button onclick="exportData()" class="p-4 rounded-xl bg-white/10 hover:bg-white/20 transition flex items-center gap-3"> <span class="text-2xl">๐ค</span>
          <div class="text-right">
           <p class="font-medium">ุชุตุฏูุฑ ุงูุจูุงูุงุช</p>
           <p class="text-sm text-gray-400">ุชุญููู ูุณุฎุฉ ุงุญุชูุงุทูุฉ</p>
          </div></button> <button onclick="syncNow()" class="p-4 rounded-xl bg-blue-500/20 hover:bg-blue-500/30 transition flex items-center gap-3"> <span class="text-2xl">๐</span>
          <div class="text-right">
           <p class="font-medium">ูุฒุงููุฉ ุงูุขู</p>
           <p class="text-sm text-gray-400">ูุฒุงููุฉ ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช</p>
          </div></button> <button onclick="clearCache()" class="p-4 rounded-xl bg-orange-500/20 hover:bg-orange-500/30 transition flex items-center gap-3"> <span class="text-2xl">๐๏ธ</span>
          <div class="text-right">
           <p class="font-medium">ูุณุญ ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ</p>
           <p class="text-sm text-gray-400">ุชุญุฏูุซ ุงูุจูุงูุงุช</p>
          </div></button> <button onclick="clearAllData()" class="p-4 rounded-xl bg-red-500/20 hover:bg-red-500/30 transition flex items-center gap-3"> <span class="text-2xl">๐๏ธ</span>
          <div class="text-right">
           <p class="font-medium">ุญุฐู ุฌููุน ุงูุจูุงูุงุช</p>
           <p class="text-sm text-gray-400">ุฅุนุงุฏุฉ ุชุนููู ุงููุชุญู</p>
          </div></button>
        </div>
       </div>
       <div class="border-t border-white/10 pt-6">
        <h4 class="font-medium mb-4">ุฅุญุตุงุฆูุงุช ุงููุธุงู</h4>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
         <div class="bg-white/5 rounded-xl p-4">
          <p class="text-2xl font-bold" id="admin-stats-total">0</p>
          <p class="text-xs text-gray-400">ุฅุฌูุงูู ุงูุณุฌูุงุช</p>
         </div>
         <div class="bg-white/5 rounded-xl p-4">
          <p class="text-2xl font-bold" id="admin-stats-ideas">0</p>
          <p class="text-xs text-gray-400">ุงูุฃููุงุฑ</p>
         </div>
         <div class="bg-white/5 rounded-xl p-4">
          <p class="text-2xl font-bold" id="admin-stats-members">0</p>
          <p class="text-xs text-gray-400">ุงูุฃุนุถุงุก</p>
         </div>
         <div class="bg-white/5 rounded-xl p-4">
          <p class="text-2xl font-bold" id="admin-stats-suggestions">0</p>
          <p class="text-xs text-gray-400">ุงูุงูุชุฑุงุญุงุช</p>
         </div>
        </div>
       </div>
      </div>
     </section><!-- Idea Detail View -->
     <section id="idea-detail-section" class="hidden max-w-5xl mx-auto"><button onclick="closeIdeaDetail()" class="mb-6 px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 transition flex items-center gap-2"> <span>โ</span> <span>ุงูุนูุฏุฉ</span> </button>
      <div id="idea-detail-content"><!-- Content will be dynamically inserted -->
      </div>
     </section>
    </main>
   </div><!-- Add Idea Modal -->
   <div id="add-idea-modal" class="hidden fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4">
    <div class="glass-effect rounded-2xl p-6 max-w-lg w-full max-h-[90%] overflow-auto">
     <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold">โจ ููุฑุฉ ุฌุฏูุฏุฉ</h2><button onclick="closeModal('add-idea')" class="text-gray-400 hover:text-white text-2xl">ร</button>
     </div>
     <form id="idea-form" class="space-y-4">
      <div><label for="idea-title" class="block text-sm font-medium mb-2">ุนููุงู ุงูููุฑุฉ</label> <input type="text" id="idea-title" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500" placeholder="ุนููุงู ูุฎุชุตุฑ ูุฌุฐุงุจ">
      </div>
      <div><label for="idea-category" class="block text-sm font-medium mb-2">ุงูุชุตููู</label> <select id="idea-category" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:outline-none focus:border-pink-500"> <option value="" class="bg-gray-800">ุงุฎุชุฑ ุงูุชุตููู</option> <option value="ุชูููุฉ" class="bg-gray-800">ุชูููุฉ ๐ป</option> <option value="ููุฑูุฉ" class="bg-gray-800">ููุฑูุฉ ๐ง</option> <option value="ุฅุจุฏุงุนูุฉ" class="bg-gray-800">ุฅุจุฏุงุนูุฉ ๐จ</option> <option value="ุนูููุฉ" class="bg-gray-800">ุนูููุฉ ๐ฌ</option> </select>
      </div>
      <div><label for="idea-content" class="block text-sm font-medium mb-2">ุชูุงุตูู ุงูููุฑุฉ</label> <textarea id="idea-content" required rows="4" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500 resize-none" placeholder="ุงุดุฑุญ ููุฑุชู ุจุงูุชูุตูู..."></textarea>
      </div>
      <div><label for="idea-tags" class="block text-sm font-medium mb-2">ูููุงุช ููุชุงุญูุฉ (ุงุถุบุท Enter ุจุนุฏ ูู ูููุฉ)</label>
       <div class="tag-input" id="tags-container"><input type="text" id="idea-tags" class="flex-1 bg-transparent outline-none text-white placeholder-gray-400 min-w-[120px]" placeholder="ุฃุถู ูููุงุช ููุชุงุญูุฉ...">
       </div><input type="hidden" id="tags-hidden">
      </div><button type="submit" id="submit-idea-btn" class="w-full py-4 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 text-white font-bold hover:opacity-90 transition"> ๐ ูุดุฑ ุงูููุฑุฉ </button>
     </form>
    </div>
   </div><!-- Add Suggestion Modal -->
   <div id="add-suggestion-modal" class="hidden fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4">
    <div class="glass-effect rounded-2xl p-6 max-w-lg w-full max-h-[90%] overflow-auto">
     <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold">๐ก ุงูุชุฑุงุญ ุฌุฏูุฏ</h2><button onclick="closeModal('add-suggestion')" class="text-gray-400 hover:text-white text-2xl">ร</button>
     </div>
     <form id="suggestion-form" class="space-y-4">
      <div><label for="suggestion-type" class="block text-sm font-medium mb-2">ููุน ุงูุงูุชุฑุงุญ</label> <select id="suggestion-type" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:outline-none focus:border-pink-500"> <option value="" class="bg-gray-800">ุงุฎุชุฑ ุงูููุน</option> <option value="ุชุตููู" class="bg-gray-800">ุชุตููู ๐จ</option> <option value="ูุญุชูู" class="bg-gray-800">ูุญุชูู ๐</option> <option value="ููุฒุงุช" class="bg-gray-800">ููุฒุงุช ุฌุฏูุฏุฉ โจ</option> <option value="ุชุญุณููุงุช" class="bg-gray-800">ุชุญุณููุงุช ๐ง</option> <option value="ุฃุฎุฑู" class="bg-gray-800">ุฃุฎุฑู ๐ฌ</option> </select>
      </div>
      <div><label for="suggestion-title" class="block text-sm font-medium mb-2">ุนููุงู ุงูุงูุชุฑุงุญ</label> <input type="text" id="suggestion-title" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500" placeholder="ุนููุงู ูุฎุชุตุฑ ููุงูุชุฑุงุญ">
      </div>
      <div><label for="suggestion-content" class="block text-sm font-medium mb-2">ุชูุงุตูู ุงูุงูุชุฑุงุญ</label> <textarea id="suggestion-content" required rows="4" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500 resize-none" placeholder="ุงุดุฑุญ ุงูุชุฑุงุญู ุจุงูุชูุตูู..."></textarea>
      </div><button type="submit" id="submit-suggestion-btn" class="w-full py-4 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 text-white font-bold hover:opacity-90 transition"> ๐ค ุฅุฑุณุงู ุงูุงูุชุฑุงุญ </button>
     </form>
    </div>
   </div><!-- Delete Confirmation Modal -->
   <div id="delete-confirm-modal" class="hidden fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4">
    <div class="glass-effect rounded-2xl p-6 max-w-sm w-full text-center">
     <div class="text-5xl mb-4">
      โ๏ธ
     </div>
     <h3 class="text-xl font-bold mb-2">ุชุฃููุฏ ุงูุญุฐู</h3>
     <p class="text-gray-400 mb-6" id="delete-confirm-text">ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุนูุตุฑุ</p>
     <div class="flex gap-3"><button onclick="closeModal('delete-confirm')" class="flex-1 py-3 rounded-xl bg-white/10 hover:bg-white/20 transition"> ุฅูุบุงุก </button> <button id="confirm-delete-btn" class="flex-1 py-3 rounded-xl bg-red-600 hover:bg-red-700 transition"> ุญุฐู </button>
     </div>
    </div>
   </div>
  </div>
  <script>
    // Supabase Configuration - Connected to External Database
    const SUPABASE_URL = 'https://lpjimlprsbtcbitanxop.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxwamltbHByc2J0Y2JpdGFueG9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU1MDQzMjMsImV4cCI6MjA1MTA4MDMyM30.VN0p_nZqYKGCqLqGGPmvLZ5Ck0c0yqRZYJ3X_cG5tW4';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // App State
    let appData = [];
    let currentUser = null;
    let currentFilter = 'all';
    let deleteTarget = null;
    let recordCount = 0;
    let isSidebarVisible = false;
    let currentTags = [];

    // Config
    const defaultConfig = {
      site_title: 'ูุชุญู ุงูููุฑ',
      site_subtitle: 'ุจูุงุจุฉ ุงูุฅุจุฏุงุน ุงูููุฑู ุงูุฑูููุฉ',
      welcome_message: 'ุญูุซ ุชุชุญูู ุงูุฃููุงุฑ ุฅูู ุฅุฑุซ ุฎุงูุฏ',
      primary_color: '#e94560',
      secondary_color: '#1a1a2e',
      text_color: '#ffffff',
      accent_color: '#f39c12',
      surface_color: '#16213e',
      font_family: 'Tajawal',
      font_size: 16
    };

    const ADMIN_NAME = 'Rasha';
    const ADMIN_SPECIALTY = '20250929';

    // Sync Status Management
    function showSyncStatus(status, message) {
      const indicator = document.getElementById('sync-indicator');
      const icon = document.getElementById('sync-icon');
      const text = document.getElementById('sync-text');
      
      indicator.className = 'sync-indicator';
      
      if (status === 'syncing') {
        indicator.classList.add('sync-syncing');
        icon.textContent = '๐';
        text.textContent = message || 'ุฌุงุฑู ุงููุฒุงููุฉ...';
      } else if (status === 'success') {
        indicator.classList.add('sync-success');
        icon.textContent = 'โ';
        text.textContent = message || 'ุชูุช ุงููุฒุงููุฉ ุจูุฌุงุญ';
        setTimeout(() => indicator.classList.add('hidden'), 3000);
      } else if (status === 'error') {
        indicator.classList.add('sync-error');
        icon.textContent = 'โ';
        text.textContent = message || 'ุฎุทุฃ ูู ุงููุฒุงููุฉ';
        setTimeout(() => indicator.classList.add('hidden'), 5000);
      }
      
      indicator.classList.remove('hidden');
    }

    // Initialize Supabase Tables
    async function initializeTables() {
      try {
        showSyncStatus('syncing', 'ุฌุงุฑู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช...');
        
        const { data: existingData, error } = await supabase
          .from('museum_data')
          .select('*')
          .limit(1);

        if (error && error.code === '42P01') {
          showSyncStatus('error', 'ุงูุฌุฏูู ุบูุฑ ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช');
          console.log('ูุฑุฌู ุฅูุดุงุก ุฌุฏูู museum_data ูู Supabase');
        } else if (!error) {
          showSyncStatus('success', 'ูุชุตู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ');
        }
      } catch (err) {
        showSyncStatus('error', 'ูุดู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช');
        console.error('ุฎุทุฃ ูู ุงูุชุญูู ูู ุงูุฌุฏุงูู:', err);
      }
    }

    // Data Handler for Data SDK
    const dataHandler = {
      async onDataChanged(data) {
        appData = data;
        recordCount = data.length;
        
        const newItems = data.filter(item => {
          return !window.syncedIds?.has(item.__backendId);
        });
        
        if (newItems.length > 0) {
          newItems.forEach(queueForSync);
          if (!window.syncedIds) window.syncedIds = new Set();
          newItems.forEach(item => window.syncedIds.add(item.__backendId));
        }
        
        updateUI();
      }
    };

    // Sync Queue Management
    let syncQueue = [];
    let isSyncing = false;
    
    async function syncWithSupabase() {
      if (isSyncing || syncQueue.length === 0) return;
      
      try {
        isSyncing = true;
        showSyncStatus('syncing', `ูุฒุงููุฉ ${syncQueue.length} ุนูุตุฑ...`);
        
        const itemsToSync = [...syncQueue];
        syncQueue = [];
        
        const insertData = itemsToSync.map(item => ({
          id: item.__backendId,
          type: item.type || '',
          title: item.title || '',
          content: item.content || '',
          author: item.author || '',
          specialty: item.specialty || '',
          category: item.category || '',
          status: item.status || '',
          created_at: item.createdAt || new Date().toISOString(),
          is_admin: item.isAdmin || false,
          role: item.role || '',
          invite_code: item.inviteCode || '',
          used_by: item.usedBy || '',
          likes: item.likes || 0,
          liked_by: item.likedBy || '',
          parent_id: item.parentId || '',
          views: item.views || 0,
          tags: item.tags || '',
          image_url: item.imageUrl || ''
        }));
        
        const { error } = await supabase.from('museum_data').upsert(insertData, { onConflict: 'id' });
        
        if (error) {
          showSyncStatus('error', 'ูุดูุช ุงููุฒุงููุฉ');
          console.error('Sync error:', error);
        } else {
          showSyncStatus('success', 'ุชูุช ุงููุฒุงููุฉ ุจูุฌุงุญ');
        }
      } catch (error) {
        showSyncStatus('error', 'ุฎุทุฃ ูู ุงููุฒุงููุฉ');
        console.error('ุฎุทุฃ ูู ุงููุฒุงููุฉ:', error);
      } finally {
        isSyncing = false;
      }
    }
    
    function queueForSync(item) {
      syncQueue.push(item);
      clearTimeout(window.syncTimeout);
      window.syncTimeout = setTimeout(syncWithSupabase, 500);
    }

    // Load Data from Supabase with Caching
    async function loadFromSupabase() {
      try {
        showSyncStatus('syncing', 'ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...');
        
        const cachedData = localStorage.getItem('museum_cache');
        const cacheTime = localStorage.getItem('museum_cache_time');
        const now = Date.now();
        
        if (cachedData && cacheTime && (now - parseInt(cacheTime)) < 300000) {
          const convertedData = JSON.parse(cachedData);
          appData = convertedData;
          recordCount = appData.length;
          updateUI();
          showSyncStatus('success', 'ุชู ุงูุชุญููู ูู ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ');
          
          loadFreshDataInBackground();
          return;
        }
        
        const { data, error } = await supabase
          .from('museum_data')
          .select('*')
          .order('created_at', { ascending: false });

        if (error) {
          showSyncStatus('error', 'ูุดู ุชุญููู ุงูุจูุงูุงุช');
          throw error;
        }

        if (data && data.length > 0) {
          const convertedData = data.map(item => ({
            __backendId: item.id,
            type: item.type || '',
            title: item.title || '',
            content: item.content || '',
            author: item.author || '',
            specialty: item.specialty || '',
            category: item.category || '',
            status: item.status || '',
            createdAt: item.created_at || new Date().toISOString(),
            isAdmin: item.is_admin || false,
            role: item.role || '',
            inviteCode: item.invite_code || '',
            usedBy: item.used_by || '',
            likes: item.likes || 0,
            likedBy: item.liked_by || '',
            parentId: item.parent_id || '',
            views: item.views || 0,
            tags: item.tags || '',
            imageUrl: item.image_url || ''
          }));

          localStorage.setItem('museum_cache', JSON.stringify(convertedData));
          localStorage.setItem('museum_cache_time', now.toString());
          
          window.syncedIds = new Set(convertedData.map(item => item.__backendId));

          appData = convertedData;
          recordCount = appData.length;
          updateUI();
          showSyncStatus('success', `ุชู ุชุญููู ${data.length} ุนูุตุฑ`);
        } else {
          showSyncStatus('success', 'ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงุฑุบุฉ');
        }
      } catch (error) {
        showSyncStatus('error', 'ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช');
        console.error('ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช:', error);
      }
    }
    
    function loadFreshDataInBackground() {
      setTimeout(async () => {
        try {
          const { data, error } = await supabase
            .from('museum_data')
            .select('*')
            .order('created_at', { ascending: false });

          if (error) return;

          if (data && data.length > 0) {
            const convertedData = data.map(item => ({
              __backendId: item.id,
              type: item.type || '',
              title: item.title || '',
              content: item.content || '',
              author: item.author || '',
              specialty: item.specialty || '',
              category: item.category || '',
              status: item.status || '',
              createdAt: item.created_at || new Date().toISOString(),
              isAdmin: item.is_admin || false,
              role: item.role || '',
              inviteCode: item.invite_code || '',
              usedBy: item.used_by || '',
              likes: item.likes || 0,
              likedBy: item.liked_by || '',
              parentId: item.parent_id || '',
              views: item.views || 0,
              tags: item.tags || '',
              imageUrl: item.image_url || ''
            }));

            localStorage.setItem('museum_cache', JSON.stringify(convertedData));
            localStorage.setItem('museum_cache_time', Date.now().toString());
            
            window.syncedIds = new Set(convertedData.map(item => item.__backendId));
          }
        } catch (error) {
          console.error('ุฎุทุฃ ูู ุงูุชุญุฏูุซ ูู ุงูุฎูููุฉ:', error);
        }
      }, 100);
    }

    // Tags Management
    function initTagsInput() {
      const input = document.getElementById('idea-tags');
      const container = document.getElementById('tags-container');
      
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ',') {
          e.preventDefault();
          const tag = input.value.trim();
          if (tag && !currentTags.includes(tag)) {
            currentTags.push(tag);
            renderTags();
            input.value = '';
          }
        }
      });
    }

    function renderTags() {
      const container = document.getElementById('tags-container');
      const input = document.getElementById('idea-tags');
      
      const tagsHTML = currentTags.map(tag => `
        <div class="tag">
          <span>${tag}</span>
          <button type="button" onclick="removeTag('${tag}')">ร</button>
        </div>
      `).join('');
      
      container.innerHTML = tagsHTML + input.outerHTML;
      
      const newInput = document.getElementById('idea-tags');
      newInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ',') {
          e.preventDefault();
          const tag = newInput.value.trim();
          if (tag && !currentTags.includes(tag)) {
            currentTags.push(tag);
            renderTags();
          }
        }
      });
      
      document.getElementById('tags-hidden').value = currentTags.join(',');
    }

    function removeTag(tag) {
      currentTags = currentTags.filter(t => t !== tag);
      renderTags();
    }

    // Search Functionality
    let searchTimeout;
    function initSearch() {
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            performSearch(e.target.value);
          }, 300);
        });
      }
    }

    function performSearch(query) {
      const resultsContainer = document.getElementById('search-results');
      if (!query.trim()) {
        resultsContainer.innerHTML = '<p class="text-gray-400 text-center py-12">ุงุจุฏุฃ ุงูุจุญุซ ูุฅูุฌุงุฏ ุงูุฃููุงุฑ...</p>';
        return;
      }

      const ideas = appData.filter(d => d.type === 'idea');
      const searchLower = query.toLowerCase();
      
      const results = ideas.filter(idea => {
        const titleMatch = idea.title.toLowerCase().includes(searchLower);
        const contentMatch = idea.content.toLowerCase().includes(searchLower);
        const authorMatch = idea.author.toLowerCase().includes(searchLower);
        const tagsMatch = idea.tags && idea.tags.toLowerCase().includes(searchLower);
        
        return titleMatch || contentMatch || authorMatch || tagsMatch;
      });

      if (results.length === 0) {
        resultsContainer.innerHTML = '<p class="text-gray-400 text-center py-12">ูู ูุชู ุงูุนุซูุฑ ุนูู ูุชุงุฆุฌ ๐</p>';
        return;
      }

      resultsContainer.innerHTML = results.map(idea => `
        <div class="glass-effect rounded-xl p-6 card-hover cursor-pointer" onclick="openIdeaDetail('${idea.__backendId}')">
          <div class="flex justify-between items-start mb-3">
            <span class="category-badge rounded-full bg-pink-600/30 text-pink-400">${getCategoryEmoji(idea.category)} ${idea.category}</span>
            ${idea.status === 'featured' ? '<span class="text-yellow-400">โญ</span>' : ''}
          </div>
          <h3 class="font-bold text-xl mb-2">${escapeHtml(idea.title)}</h3>
          <p class="text-gray-400 mb-3 line-clamp-2">${escapeHtml(idea.content)}</p>
          ${idea.tags ? `
            <div class="flex flex-wrap gap-2 mb-3">
              ${idea.tags.split(',').map(tag => `<span class="text-xs bg-pink-500/20 text-pink-400 px-2 py-1 rounded-full">#${tag.trim()}</span>`).join('')}
            </div>
          ` : ''}
          <div class="flex justify-between items-center text-sm text-gray-500">
            <span>๐ค ${escapeHtml(idea.author)}</span>
            <div class="flex items-center gap-3">
              <span>${idea.views || 0} ๐๏ธ</span>
              <span>${idea.likes || 0} โค๏ธ</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Initialize App
    async function initApp() {
      try {
        await initializeTables();
        
        const storedUser = localStorage.getItem('museum_user');
        if (storedUser) {
          currentUser = JSON.parse(storedUser);
          showDashboard();
          hideLoading();
        }
        
        await loadFromSupabase();

        if (window.dataSdk) {
          const result = await window.dataSdk.init(dataHandler);
          if (!result.isOk) {
            console.error('Failed to init data SDK');
          }
        }

        if (window.elementSdk) {
          window.elementSdk.init({
            defaultConfig,
            onConfigChange: applyConfig,
            mapToCapabilities: (config) => ({
              recolorables: [
                { get: () => config.primary_color || defaultConfig.primary_color, set: (v) => window.elementSdk.setConfig({ primary_color: v }) },
                { get: () => config.secondary_color || defaultConfig.secondary_color, set: (v) => window.elementSdk.setConfig({ secondary_color: v }) },
                { get: () => config.text_color || defaultConfig.text_color, set: (v) => window.elementSdk.setConfig({ text_color: v }) },
                { get: () => config.accent_color || defaultConfig.accent_color, set: (v) => window.elementSdk.setConfig({ accent_color: v }) },
                { get: () => config.surface_color || defaultConfig.surface_color, set: (v) => window.elementSdk.setConfig({ surface_color: v }) }
              ],
              borderables: [],
              fontEditable: { get: () => config.font_family || defaultConfig.font_family, set: (v) => window.elementSdk.setConfig({ font_family: v }) },
              fontSizeable: { get: () => config.font_size || defaultConfig.font_size, set: (v) => window.elementSdk.setConfig({ font_size: v }) }
            }),
            mapToEditPanelValues: (config) => new Map([
              ['site_title', config.site_title || defaultConfig.site_title],
              ['site_subtitle', config.site_subtitle || defaultConfig.site_subtitle],
              ['welcome_message', config.welcome_message || defaultConfig.welcome_message]
            ])
          });
        }

        if (!storedUser) {
          showLogin();
          hideLoading();
        }
        
        document.getElementById('menu-toggle').addEventListener('click', toggleSidebar);
        initTagsInput();
        initSearch();
      } catch (err) {
        console.error('Init error:', err);
        hideLoading();
        showLogin();
      }
    }

    // Apply Config
    async function applyConfig(config) {
      const c = { ...defaultConfig, ...config };
      
      document.getElementById('login-title').textContent = c.site_title;
      document.getElementById('login-subtitle').textContent = c.site_subtitle;
      document.getElementById('login-welcome').textContent = c.welcome_message;
      document.getElementById('sidebar-title').textContent = c.site_title;

      document.body.style.fontFamily = `${c.font_family}, Tajawal, sans-serif`;
      document.body.style.fontSize = `${c.font_size}px`;
    }

    // Sidebar Functions
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      isSidebarVisible = !isSidebarVisible;
      
      if (isSidebarVisible) {
        sidebar.classList.remove('sidebar-hidden');
        sidebar.classList.add('sidebar-visible');
      } else {
        sidebar.classList.remove('sidebar-visible');
        sidebar.classList.add('sidebar-hidden');
      }
    }

    function hideSidebar() {
      const sidebar = document.getElementById('sidebar');
      isSidebarVisible = false;
      sidebar.classList.remove('sidebar-visible');
      sidebar.classList.add('sidebar-hidden');
    }

    // UI Functions
    function hideLoading() {
      document.getElementById('loading-screen').classList.add('hidden');
    }

    function showLogin() {
      document.getElementById('login-page').classList.remove('hidden');
      document.getElementById('dashboard').classList.add('hidden');
    }

    function showDashboard() {
      document.getElementById('login-page').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      
      document.getElementById('user-name').textContent = currentUser.name;
      document.getElementById('user-specialty').textContent = currentUser.specialty;
      document.getElementById('user-avatar').textContent = currentUser.role === 'admin' ? '๐' : '๐ก';
      
      const isAdmin = currentUser.role === 'admin';
      
      document.getElementById('settings-btn').classList.toggle('hidden', !isAdmin);
      document.getElementById('members-btn').classList.toggle('hidden', !isAdmin);
      document.getElementById('invites-btn').classList.toggle('hidden', !isAdmin);
      document.getElementById('admin-stats-section').classList.toggle('hidden', !isAdmin);
      document.getElementById('add-idea-home-btn').classList.remove('hidden');
      document.getElementById('add-idea-btn').classList.remove('hidden');
      
      updateUI();
    }

    function navigateTo(section) {
      const sections = ['home', 'ideas', 'trending', 'content', 'philosophy', 'quotes', 'search', 'members', 'suggestions', 'settings', 'invites'];
      sections.forEach(s => {
        const el = document.getElementById(`${s}-section`);
        const btn = document.querySelector(`[data-section="${s}"]`);
        if (el) el.classList.add('hidden');
        if (btn) btn.classList.remove('active');
      });
      
      const activeSection = document.getElementById(`${section}-section`);
      const activeBtn = document.querySelector(`[data-section="${section}"]`);
      if (activeSection) activeSection.classList.remove('hidden');
      if (activeBtn) activeBtn.classList.add('active');
      
      document.getElementById('idea-detail-section').classList.add('hidden');
      
      hideSidebar();
    }

    function openModal(type) {
      document.getElementById(`${type}-modal`).classList.remove('hidden');
      if (type === 'add-idea') {
        currentTags = [];
        renderTags();
      }
    }

    function closeModal(type) {
      document.getElementById(`${type}-modal`).classList.add('hidden');
    }

    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast px-4 py-3 rounded-xl ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} text-white shadow-lg`;
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Update UI
    let lastRenderedState = {};
    
    function updateUI() {
      const ideas = appData.filter(d => d.type === 'idea');
      const members = appData.filter(d => d.type === 'member');
      const suggestions = appData.filter(d => d.type === 'suggestion');
      const invites = appData.filter(d => d.type === 'invite');
      const featured = ideas.filter(i => i.status === 'featured');
      const totalViews = ideas.reduce((sum, i) => sum + (i.views || 0), 0);

      const currentState = {
        ideasCount: ideas.length,
        membersCount: members.length,
        suggestionsCount: suggestions.length,
        featuredCount: featured.length,
        viewsCount: totalViews
      };

      if (currentUser?.role === 'admin') {
        if (lastRenderedState.ideasCount !== currentState.ideasCount) {
          document.getElementById('stats-ideas').textContent = ideas.length;
        }
        if (lastRenderedState.membersCount !== currentState.membersCount) {
          document.getElementById('stats-members').textContent = members.length;
        }
        if (lastRenderedState.viewsCount !== currentState.viewsCount) {
          document.getElementById('stats-views').textContent = totalViews;
        }
        if (lastRenderedState.featuredCount !== currentState.featuredCount) {
          document.getElementById('stats-featured').textContent = featured.length;
        }
      }

      const badge = document.getElementById('suggestions-badge');
      if (currentUser?.role === 'admin') {
        const pendingSuggestions = suggestions.filter(s => s.status === 'pending').length;
        if (pendingSuggestions > 0) {
          badge.textContent = pendingSuggestions;
          badge.classList.remove('hidden');
        } else {
          badge.classList.add('hidden');
        }
      } else {
        badge.classList.add('hidden');
      }

      const homeSection = document.getElementById('home-section');
      const ideasSection = document.getElementById('ideas-section');
      const trendingSection = document.getElementById('trending-section');
      
      if (!homeSection.classList.contains('hidden')) {
        renderRecentIdeas(ideas.slice(-6).reverse());
      }
      
      if (!ideasSection.classList.contains('hidden')) {
        renderIdeasGrid(currentFilter === 'all' ? ideas : ideas.filter(i => i.category === currentFilter));
      }

      if (!trendingSection.classList.contains('hidden')) {
        const trending = [...ideas].sort((a, b) => {
          const scoreA = (a.likes || 0) * 2 + (a.views || 0);
          const scoreB = (b.likes || 0) * 2 + (b.views || 0);
          return scoreB - scoreA;
        }).slice(0, 12);
        renderTrendingGrid(trending);
      }
      
      if (currentUser?.role === 'admin') {
        const membersSection = document.getElementById('members-section');
        const suggestionsSection = document.getElementById('suggestions-section');
        const invitesSection = document.getElementById('invites-section');
        
        if (!membersSection.classList.contains('hidden')) {
          renderMembers(members);
        }
        if (!suggestionsSection.classList.contains('hidden')) {
          renderSuggestions(suggestions);
        }
        if (!invitesSection.classList.contains('hidden')) {
          renderInvites(invites);
        }
        
        document.getElementById('admin-stats-total').textContent = appData.length;
        document.getElementById('admin-stats-ideas').textContent = ideas.length;
        document.getElementById('admin-stats-members').textContent = members.length;
        document.getElementById('admin-stats-suggestions').textContent = suggestions.length;
      }
      
      lastRenderedState = currentState;
    }

    function renderRecentIdeas(ideas) {
      const container = document.getElementById('recent-ideas');
      if (ideas.length === 0) {
        container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-8">ูุง ุชูุฌุฏ ุฃููุงุฑ ุจุนุฏ. ูู ุฃูู ูู ูุดุงุฑู!</p>';
        return;
      }
      
      container.innerHTML = ideas.map(idea => {
        const likeCount = idea.likes || 0;
        const viewCount = idea.views || 0;
        
        return `
        <div class="idea-card rounded-xl p-4 card-hover cursor-pointer" onclick="openIdeaDetail('${idea.__backendId}')">
          <div class="flex justify-between items-start mb-2">
            <span class="category-badge rounded-full bg-pink-600/30 text-pink-400">${getCategoryEmoji(idea.category)} ${idea.category}</span>
            ${idea.status === 'featured' ? '<span class="text-yellow-400">โญ</span>' : ''}
          </div>
          <h3 class="font-bold text-lg mb-2">${escapeHtml(idea.title)}</h3>
          <p class="text-gray-400 text-sm mb-3 line-clamp-2">${escapeHtml(idea.content)}</p>
          ${idea.tags ? `
            <div class="flex flex-wrap gap-1 mb-2">
              ${idea.tags.split(',').slice(0, 3).map(tag => `<span class="text-xs bg-pink-500/20 text-pink-400 px-2 py-0.5 rounded-full">#${tag.trim()}</span>`).join('')}
            </div>
          ` : ''}
          <div class="flex justify-between items-center text-xs text-gray-500">
            <span>๐ค ${escapeHtml(idea.author)}</span>
            <div class="flex items-center gap-2">
              <span>${viewCount} ๐๏ธ</span>
              <span>${likeCount} โค๏ธ</span>
            </div>
          </div>
        </div>
      `;
      }).join('');
    }

    function renderIdeasGrid(ideas) {
      const container = document.getElementById('ideas-grid');
      if (ideas.length === 0) {
        container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-12">ูุง ุชูุฌุฏ ุฃููุงุฑ ูู ูุฐุง ุงููุณู ุจุนุฏ</p>';
        return;
      }
      
      container.innerHTML = ideas.map(idea => {
        const likeCount = idea.likes || 0;
        const viewCount = idea.views || 0;
        const commentCount = appData.filter(d => d.type === 'comment' && d.parentId === idea.__backendId).length;
        
        return `
        <div class="idea-card rounded-2xl p-5 card-hover relative group cursor-pointer" onclick="openIdeaDetail('${idea.__backendId}')">
          ${currentUser?.role === 'admin' ? `
            <div class="absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition flex gap-1 z-10">
              <button onclick="event.stopPropagation(); toggleFeatured('${idea.__backendId}')" class="p-2 rounded-lg bg-white/10 hover:bg-yellow-500/30 transition" title="ุชูููุฒ">
                ${idea.status === 'featured' ? 'โญ' : 'โ'}
              </button>
              <button onclick="event.stopPropagation(); confirmDelete('idea', '${idea.__backendId}')" class="p-2 rounded-lg bg-white/10 hover:bg-red-500/30 transition" title="ุญุฐู">
                ๐๏ธ
              </button>
            </div>
          ` : ''}
          <div class="flex justify-between items-start mb-3">
            <span class="category-badge rounded-full bg-pink-600/30 text-pink-400">${getCategoryEmoji(idea.category)} ${idea.category}</span>
            ${idea.status === 'featured' ? '<span class="text-yellow-400 text-xl">โญ</span>' : ''}
          </div>
          <h3 class="font-bold text-xl mb-3">${escapeHtml(idea.title)}</h3>
          <p class="text-gray-400 mb-4 line-clamp-3">${escapeHtml(idea.content)}</p>
          ${idea.tags ? `
            <div class="flex flex-wrap gap-2 mb-3">
              ${idea.tags.split(',').slice(0, 3).map(tag => `<span class="text-xs bg-pink-500/20 text-pink-400 px-2 py-1 rounded-full">#${tag.trim()}</span>`).join('')}
            </div>
          ` : ''}
          <div class="flex justify-between items-center text-sm text-gray-500 pt-3 border-t border-white/10">
            <span>๐ค ${escapeHtml(idea.author)}</span>
            <div class="flex items-center gap-3">
              <span>${viewCount} ๐๏ธ</span>
              <span>${commentCount} ๐ฌ</span>
              <span>${likeCount} โค๏ธ</span>
            </div>
          </div>
        </div>
      `;
      }).join('');
    }

    function renderTrendingGrid(ideas) {
      const container = document.getElementById('trending-grid');
      if (ideas.length === 0) {
        container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-12">ูุง ุชูุฌุฏ ุฃููุงุฑ ุฑุงุฆุฌุฉ ุจุนุฏ</p>';
        return;
      }
      
      container.innerHTML = ideas.map((idea, index) => {
        const likeCount = idea.likes || 0;
        const viewCount = idea.views || 0;
        const score = likeCount * 2 + viewCount;
        
        return `
        <div class="idea-card rounded-2xl p-5 card-hover cursor-pointer relative" onclick="openIdeaDetail('${idea.__backendId}')">
          ${index < 3 ? `<div class="absolute top-2 right-2 text-2xl">${index === 0 ? '๐ฅ' : index === 1 ? '๐ฅ' : '๐ฅ'}</div>` : ''}
          <div class="flex justify-between items-start mb-3">
            <span class="category-badge rounded-full bg-pink-600/30 text-pink-400">${getCategoryEmoji(idea.category)} ${idea.category}</span>
            ${idea.status === 'featured' ? '<span class="text-yellow-400">โญ</span>' : ''}
          </div>
          <h3 class="font-bold text-xl mb-3">${escapeHtml(idea.title)}</h3>
          <p class="text-gray-400 mb-4 line-clamp-2">${escapeHtml(idea.content)}</p>
          <div class="flex justify-between items-center text-sm text-gray-500 pt-3 border-t border-white/10">
            <span>๐ค ${escapeHtml(idea.author)}</span>
            <div class="flex items-center gap-3">
              <span>${viewCount} ๐๏ธ</span>
              <span>${likeCount} โค๏ธ</span>
              <span class="text-pink-400 font-bold">${score} ๐ฅ</span>
            </div>
          </div>
        </div>
      `;
      }).join('');
    }

    function renderMembers(members) {
      const container = document.getElementById('members-grid');
      if (members.length === 0) {
        container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-12">ูุง ููุฌุฏ ุฃุนุถุงุก ูุณุฌููู ุจุนุฏ</p>';
        return;
      }
      
      container.innerHTML = members.map(member => {
        const roleEmoji = member.role === 'admin' ? '๐' : '๐ก';
        const memberIdeas = appData.filter(d => d.type === 'idea' && d.author === member.title);
        
        return `
        <div class="glass-effect rounded-xl p-4 flex items-center gap-4 card-hover relative group">
          ${currentUser?.role === 'admin' ? `
            <button onclick="confirmDelete('member', '${member.__backendId}')" class="absolute top-2 left-2 opacity-0 group-hover:opacity-100 p-2 rounded-lg bg-white/10 hover:bg-red-500/30 transition">
              ๐๏ธ
            </button>
          ` : ''}
          <div class="w-14 h-14 rounded-full bg-gradient-to-r from-pink-600 to-orange-500 flex items-center justify-center text-2xl">
            ${roleEmoji}
          </div>
          <div>
            <h3 class="font-bold">${escapeHtml(member.title)}</h3>
            <p class="text-sm text-gray-400">${escapeHtml(member.specialty || '')}</p>
            <p class="text-xs text-gray-500">${memberIdeas.length} ููุฑุฉ โข ${member.role === 'admin' ? 'ูุฏูุฑ' : 'ุนุถู'}</p>
          </div>
        </div>
      `;
      }).join('');
    }

    function renderSuggestions(suggestions) {
      const container = document.getElementById('suggestions-list');
      
      if (suggestions.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center py-12">ูุง ุชูุฌุฏ ุงูุชุฑุงุญุงุช ุจุนุฏ. ูู ุฃูู ูู ููุชุฑุญ!</p>';
        return;
      }
      
      container.innerHTML = suggestions.map(suggestion => `
        <div class="glass-effect rounded-xl p-5 card-hover relative group">
          ${currentUser?.role === 'admin' ? `
            <div class="absolute top-3 left-3 opacity-0 group-hover:opacity-100 transition flex gap-1">
              <button onclick="updateSuggestionStatus('${suggestion.__backendId}', 'approved')" class="p-2 rounded-lg bg-green-500/20 hover:bg-green-500/40 transition" title="ูุจูู">โ</button>
              <button onclick="updateSuggestionStatus('${suggestion.__backendId}', 'rejected')" class="p-2 rounded-lg bg-red-500/20 hover:bg-red-500/40 transition" title="ุฑูุถ">โ</button>
              <button onclick="confirmDelete('suggestion', '${suggestion.__backendId}')" class="p-2 rounded-lg bg-white/10 hover:bg-red-500/30 transition" title="ุญุฐู">๐๏ธ</button>
            </div>
          ` : ''}
          <div class="flex items-start gap-4">
            <div class="text-3xl">${getSuggestionEmoji(suggestion.category)}</div>
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-2">
                <span class="category-badge rounded-full bg-white/10">${suggestion.category}</span>
                <span class="category-badge rounded-full ${getStatusColor(suggestion.status)}">${getStatusText(suggestion.status)}</span>
              </div>
              <h3 class="font-bold text-lg mb-2">${escapeHtml(suggestion.title)}</h3>
              <p class="text-gray-400 mb-3">${escapeHtml(suggestion.content)}</p>
              <div class="text-sm text-gray-500">
                <span>๐ค ${escapeHtml(suggestion.author)}</span>
                <span class="mx-2">โข</span>
                <span>${formatDate(suggestion.createdAt)}</span>
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderInvites(invites) {
      const container = document.getElementById('invites-grid');
      if (invites.length === 0) {
        container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-12">ูุง ุชูุฌุฏ ุฑููุฒ ุฏุนูุฉ ุจุนุฏ</p>';
        return;
      }
      
      container.innerHTML = invites.map(invite => `
        <div class="glass-effect rounded-xl p-5 card-hover relative group">
          ${currentUser?.role === 'admin' ? `
            <button onclick="confirmDelete('invite', '${invite.__backendId}')" class="absolute top-2 left-2 opacity-0 group-hover:opacity-100 p-2 rounded-lg bg-white/10 hover:bg-red-500/30 transition">
              ๐๏ธ
            </button>
          ` : ''}
          <div class="flex items-center gap-4 mb-3">
            <div class="text-3xl">๐ซ</div>
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <span class="font-mono text-lg text-pink-400">${invite.inviteCode}</span>
                <button onclick="copyInviteCode('${invite.inviteCode}')" class="p-1 rounded hover:bg-white/10 transition" title="ูุณุฎ">
                  ๐
                </button>
              </div>
              <p class="text-xs text-gray-500">ุชู ุงูุฅูุดุงุก ${formatDate(invite.createdAt)}</p>
            </div>
          </div>
          <div class="pt-3 border-t border-white/10">
            ${invite.usedBy ? `
              <div class="flex items-center gap-2 text-sm">
                <span class="text-green-400">โ ูุณุชุฎุฏู</span>
                <span class="text-gray-400">ุจูุงุณุทุฉ: ${escapeHtml(invite.usedBy)}</span>
              </div>
            ` : `
              <span class="text-sm text-gray-400">โณ ูุชุงุญ ููุงุณุชุฎุฏุงู</span>
            `}
          </div>
        </div>
      `).join('');
    }

    // Filter Ideas
    function filterIdeas(category) {
      currentFilter = category;
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      updateUI();
    }

    // Helper Functions
    function getCategoryEmoji(category) {
      const emojis = { 'ุชูููุฉ': '๐ป', 'ููุฑูุฉ': '๐ง', 'ุฅุจุฏุงุนูุฉ': '๐จ', 'ุนูููุฉ': '๐ฌ' };
      return emojis[category] || '๐ก';
    }

    function getSuggestionEmoji(type) {
      const emojis = { 'ุชุตููู': '๐จ', 'ูุญุชูู': '๐', 'ููุฒุงุช': 'โจ', 'ุชุญุณููุงุช': '๐ง', 'ุฃุฎุฑู': '๐ฌ' };
      return emojis[type] || '๐ก';
    }

    function getStatusColor(status) {
      const colors = { 'pending': 'bg-yellow-500/30 text-yellow-400', 'approved': 'bg-green-500/30 text-green-400', 'rejected': 'bg-red-500/30 text-red-400' };
      return colors[status] || colors.pending;
    }

    function getStatusText(status) {
      const texts = { 'pending': 'ููุฏ ุงููุฑุงุฌุนุฉ', 'approved': 'ููุจูู', 'rejected': 'ูุฑููุถ' };
      return texts[status] || 'ููุฏ ุงููุฑุงุฌุนุฉ';
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      return date.toLocaleDateString('ar-SA', { year: 'numeric', month: 'short', day: 'numeric' });
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function generateRandomCode() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let code = '';
      for (let i = 0; i < 8; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return code;
    }

    function hasUserLiked(idea) {
      if (!idea.likedBy || !currentUser) return false;
      const likedArray = idea.likedBy.split(',').filter(u => u);
      return likedArray.includes(currentUser.name);
    }

    // Event Handlers
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('login-name').value.trim();
      const specialty = document.getElementById('login-specialty').value.trim();

      let userRole = 'member';

      if (name === ADMIN_NAME && specialty === ADMIN_SPECIALTY) {
        userRole = 'admin';
      }

      if (recordCount >= 999) {
        showToast('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุงูุณุฌูุงุช', 'error');
        return;
      }

      const btn = document.getElementById('login-btn');
      btn.disabled = true;
      btn.textContent = 'ุฌุงุฑู ุงูุชุณุฌูู...';

      currentUser = {
        name,
        specialty,
        role: userRole
      };

      localStorage.setItem('museum_user', JSON.stringify(currentUser));

      const existingMember = appData.find(d => d.type === 'member' && d.title === name);
      
      if (!existingMember && window.dataSdk) {
        const result = await window.dataSdk.create({
          type: 'member',
          title: name,
          specialty: specialty,
          role: userRole,
          isAdmin: userRole === 'admin',
          createdAt: new Date().toISOString(),
          status: 'active',
          content: '',
          author: name,
          category: '',
          inviteCode: '',
          usedBy: '',
          likes: 0,
          likedBy: '',
          parentId: '',
          views: 0,
          tags: '',
          imageUrl: ''
        });
        
        if (!result.isOk) {
          showToast('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุณุฌูู', 'error');
        }
      }

      btn.disabled = false;
      btn.textContent = '๐ ุฏุฎูู ุงููุชุญู';
      showDashboard();
      showToast(`ูุฑุญุจุงู ${name}! ๐`);
    });

    document.getElementById('idea-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showToast('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุงูุณุฌูุงุช', 'error');
        return;
      }

      const btn = document.getElementById('submit-idea-btn');
      btn.disabled = true;
      btn.textContent = 'ุฌุงุฑู ุงููุดุฑ...';

      const idea = {
        type: 'idea',
        title: document.getElementById('idea-title').value.trim(),
        category: document.getElementById('idea-category').value,
        content: document.getElementById('idea-content').value.trim(),
        author: currentUser.name,
        specialty: currentUser.specialty,
        status: 'active',
        createdAt: new Date().toISOString(),
        isAdmin: currentUser.role === 'admin',
        role: currentUser.role,
        inviteCode: '',
        usedBy: '',
        likes: 0,
        likedBy: '',
        parentId: '',
        views: 0,
        tags: currentTags.join(','),
        imageUrl: ''
      };

      if (window.dataSdk) {
        const result = await window.dataSdk.create(idea);
        if (result.isOk) {
          showToast('ุชู ูุดุฑ ููุฑุชู ุจูุฌุงุญ! โจ');
          closeModal('add-idea');
          document.getElementById('idea-form').reset();
          currentTags = [];
        } else {
          showToast('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุดุฑ ุงูููุฑุฉ', 'error');
        }
      }

      btn.disabled = false;
      btn.textContent = '๐ ูุดุฑ ุงูููุฑุฉ';
    });

    document.getElementById('suggestion-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showToast('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุงูุณุฌูุงุช', 'error');
        return;
      }

      const btn = document.getElementById('submit-suggestion-btn');
      btn.disabled = true;
      btn.textContent = 'ุฌุงุฑู ุงูุฅุฑุณุงู...';

      const suggestion = {
        type: 'suggestion',
        category: document.getElementById('suggestion-type').value,
        title: document.getElementById('suggestion-title').value.trim(),
        content: document.getElementById('suggestion-content').value.trim(),
        author: currentUser.name,
        specialty: currentUser.specialty,
        status: 'pending',
        createdAt: new Date().toISOString(),
        isAdmin: false,
        role: currentUser.role,
        inviteCode: '',
        usedBy: '',
        likes: 0,
        likedBy: '',
        parentId: '',
        views: 0,
        tags: '',
        imageUrl: ''
      };

      if (window.dataSdk) {
        const result = await window.dataSdk.create(suggestion);
        if (result.isOk) {
          showToast('ุชู ุฅุฑุณุงู ุงูุชุฑุงุญู ุจูุฌุงุญ! ๐ก');
          closeModal('add-suggestion');
          document.getElementById('suggestion-form').reset();
        } else {
          showToast('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุฑุณุงู ุงูุงูุชุฑุงุญ', 'error');
        }
      }

      btn.disabled = false;
      btn.textContent = '๐ค ุฅุฑุณุงู ุงูุงูุชุฑุงุญ';
    });

    // Admin Functions
    async function generateInviteCode() {
      if (recordCount >= 999) {
        showToast('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุงูุณุฌูุงุช', 'error');
        return;
      }

      const code = generateRandomCode();
      
      if (window.dataSdk) {
        const result = await window.dataSdk.create({
          type: 'invite',
          inviteCode: code,
          usedBy: '',
          createdAt: new Date().toISOString(),
          status: 'active',
          title: `ุฑูุฒ ุฏุนูุฉ ${code}`,
          content: '',
          author: currentUser.name,
          specialty: '',
          category: '',
          isAdmin: false,
          role: '',
          likes: 0,
          likedBy: '',
          parentId: '',
          views: 0,
          tags: '',
          imageUrl: ''
        });
        
        if (result.isOk) {
          showToast(`ุชู ุฅูุดุงุก ุฑูุฒ ุงูุฏุนูุฉ: ${code} ๐ซ`);
        } else {
          showToast('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุฑูุฒ ุงูุฏุนูุฉ', 'error');
        }
      }
    }

    function copyInviteCode(code) {
      navigator.clipboard.writeText(code).then(() => {
        showToast('ุชู ูุณุฎ ุฑูุฒ ุงูุฏุนูุฉ ๐');
      }).catch(() => {
        showToast('ูุดู ูุณุฎ ุงูุฑูุฒ', 'error');
      });
    }

    async function toggleFeatured(id) {
      const item = appData.find(d => d.__backendId === id);
      if (item && window.dataSdk) {
        const newStatus = item.status === 'featured' ? 'active' : 'featured';
        const result = await window.dataSdk.update({ ...item, status: newStatus });
        if (result.isOk) {
          showToast(newStatus === 'featured' ? 'ุชู ุชูููุฒ ุงูููุฑุฉ โญ' : 'ุชู ุฅูุบุงุก ุงูุชูููุฒ');
        }
      }
    }

    async function updateSuggestionStatus(id, status) {
      const item = appData.find(d => d.__backendId === id);
      if (item && window.dataSdk) {
        const result = await window.dataSdk.update({ ...item, status });
        if (result.isOk) {
          showToast(status === 'approved' ? 'ุชู ูุจูู ุงูุงูุชุฑุงุญ โ' : 'ุชู ุฑูุถ ุงูุงูุชุฑุงุญ โ');
        }
      }
    }

    async function toggleLike(ideaId) {
      const idea = appData.find(d => d.__backendId === ideaId);
      if (!idea || !window.dataSdk) return;

      const likedByArray = idea.likedBy ? idea.likedBy.split(',').filter(u => u) : [];
      const hasLiked = likedByArray.includes(currentUser.name);
      
      let newLikedBy;
      let newLikes;
      
      if (hasLiked) {
        newLikedBy = likedByArray.filter(u => u !== currentUser.name).join(',');
        newLikes = Math.max(0, (idea.likes || 0) - 1);
      } else {
        likedByArray.push(currentUser.name);
        newLikedBy = likedByArray.join(',');
        newLikes = (idea.likes || 0) + 1;
      }
      
      const result = await window.dataSdk.update({
        ...idea,
        likes: newLikes,
        likedBy: newLikedBy
      });
      
      if (result.isOk) {
        showToast(hasLiked ? 'ุชู ุฅูุบุงุก ุงูุฅุนุฌุงุจ' : 'ุชู ุงูุฅุนุฌุงุจ ุจุงูููุฑุฉ โค๏ธ');
        if (!document.getElementById('idea-detail-section').classList.contains('hidden')) {
          openIdeaDetail(ideaId);
        }
      }
    }

    async function addComment(ideaId) {
      const commentInput = document.getElementById('comment-input');
      const commentText = commentInput.value.trim();
      
      if (!commentText) {
        showToast('ุงูุฑุฌุงุก ูุชุงุจุฉ ุชุนููู', 'error');
        return;
      }

      if (recordCount >= 999) {
        showToast('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุงูุณุฌูุงุช', 'error');
        return;
      }

      const btn = document.getElementById('add-comment-btn');
      btn.disabled = true;
      btn.textContent = 'ุฌุงุฑู ุงูุฅุฑุณุงู...';

      if (window.dataSdk) {
        const result = await window.dataSdk.create({
          type: 'comment',
          parentId: ideaId,
          content: commentText,
          author: currentUser.name,
          createdAt: new Date().toISOString(),
          title: '',
          specialty: currentUser.specialty,
          category: '',
          status: 'active',
          isAdmin: false,
          role: currentUser.role,
          inviteCode: '',
          usedBy: '',
          likes: 0,
          likedBy: '',
          views: 0,
          tags: '',
          imageUrl: ''
        });
        
        if (result.isOk) {
          showToast('ุชู ุฅุถุงูุฉ ุชุนูููู ๐ฌ');
          commentInput.value = '';
          openIdeaDetail(ideaId);
        } else {
          showToast('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุถุงูุฉ ุงูุชุนููู', 'error');
        }
      }

      btn.disabled = false;
      btn.textContent = '๐ฌ ุฅุฑุณุงู';
    }

    function confirmDelete(type, id) {
      deleteTarget = { type, id };
      const texts = { idea: 'ูุฐู ุงูููุฑุฉ', member: 'ูุฐุง ุงูุนุถู', suggestion: 'ูุฐุง ุงูุงูุชุฑุงุญ', invite: 'ุฑูุฒ ุงูุฏุนูุฉ ูุฐุง' };
      document.getElementById('delete-confirm-text').textContent = `ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ${texts[type]}ุ`;
      openModal('delete-confirm');
    }

    document.getElementById('confirm-delete-btn').addEventListener('click', async () => {
      if (deleteTarget && window.dataSdk) {
        const item = appData.find(d => d.__backendId === deleteTarget.id);
        if (item) {
          const result = await window.dataSdk.delete(item);
          if (result.isOk) {
            showToast('ุชู ุงูุญุฐู ุจูุฌุงุญ');
            if (deleteTarget.type === 'idea' && !document.getElementById('idea-detail-section').classList.contains('hidden')) {
              closeIdeaDetail();
            }
          } else {
            showToast('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู', 'error');
          }
        }
      }
      closeModal('delete-confirm');
      deleteTarget = null;
    });

    function exportData() {
      const dataStr = JSON.stringify(appData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `museum_backup_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('ุชู ุชุตุฏูุฑ ุงูุจูุงูุงุช ุจูุฌุงุญ ๐ค');
    }

    async function syncNow() {
      showSyncStatus('syncing', 'ุฌุงุฑู ุงููุฒุงููุฉ...');
      localStorage.removeItem('museum_cache');
      localStorage.removeItem('museum_cache_time');
      await loadFromSupabase();
      showToast('ุชู ุชุญุฏูุซ ุงูุจูุงูุงุช ๐');
    }

    function clearCache() {
      localStorage.removeItem('museum_cache');
      localStorage.removeItem('museum_cache_time');
      showToast('ุชู ูุณุญ ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ ๏ฟฝ๏ฟฝ๏ธ');
      window.location.reload();
    }

    async function clearAllData() {
      deleteTarget = { type: 'all' };
      document.getElementById('delete-confirm-text').textContent = 'ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุฌููุน ุงูุจูุงูุงุชุ ูุฐุง ุงูุฅุฌุฑุงุก ูุง ูููู ุงูุชุฑุงุฌุน ุนูู!';
      openModal('delete-confirm');
      
      document.getElementById('confirm-delete-btn').onclick = async () => {
        if (window.dataSdk) {
          for (const item of appData) {
            await window.dataSdk.delete(item);
          }
          showToast('ุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช');
        }
        closeModal('delete-confirm');
      };
    }

    function logout() {
      localStorage.removeItem('museum_user');
      currentUser = null;
      showLogin();
      showToast('ุชู ุชุณุฌูู ุงูุฎุฑูุฌ');
    }

    // Idea Detail Functions
    async function openIdeaDetail(ideaId) {
      const idea = appData.find(d => d.__backendId === ideaId);
      if (!idea) return;

      // Increment views
      const newViews = (idea.views || 0) + 1;
      if (window.dataSdk) {
        await window.dataSdk.update({ ...idea, views: newViews });
      }

      const comments = appData.filter(d => d.type === 'comment' && d.parentId === ideaId);
      const likeCount = idea.likes || 0;
      const viewCount = idea.views || 0;
      const hasLiked = hasUserLiked(idea);

      const detailContent = document.getElementById('idea-detail-content');
      detailContent.innerHTML = `
        <div class="glass-effect rounded-3xl p-8 space-y-6">
          <div class="flex justify-between items-start flex-wrap gap-4">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-3">
                <span class="category-badge rounded-full bg-pink-600/30 text-pink-400 text-sm">
                  ${getCategoryEmoji(idea.category)} ${idea.category}
                </span>
                ${idea.status === 'featured' ? '<span class="text-yellow-400 text-2xl">โญ</span>' : ''}
              </div>
              <h1 class="text-4xl font-bold mb-4">${escapeHtml(idea.title)}</h1>
              ${idea.tags ? `
                <div class="flex flex-wrap gap-2 mb-3">
                  ${idea.tags.split(',').map(tag => `<span class="text-sm bg-pink-500/20 text-pink-400 px-3 py-1 rounded-full">#${tag.trim()}</span>`).join('')}
                </div>
              ` : ''}
            </div>
            ${currentUser?.role === 'admin' ? `
              <div class="flex gap-2">
                <button onclick="toggleFeatured('${idea.__backendId}')" class="p-3 rounded-xl bg-white/10 hover:bg-yellow-500/30 transition" title="ุชูููุฒ">
                  ${idea.status === 'featured' ? 'โญ ุฅูุบุงุก ุงูุชูููุฒ' : 'โ ุชูููุฒ'}
                </button>
                <button onclick="confirmDelete('idea', '${idea.__backendId}')" class="p-3 rounded-xl bg-white/10 hover:bg-red-500/30 transition" title="ุญุฐู">
                  ๐๏ธ ุญุฐู
                </button>
              </div>
            ` : ''}
          </div>

          <div class="flex items-center gap-4 pb-6 border-b border-white/10">
            <div class="w-16 h-16 rounded-full bg-gradient-to-r from-pink-600 to-orange-500 flex items-center justify-center text-2xl">
              ${idea.role === 'admin' ? '๐' : '๐ก'}
            </div>
            <div>
              <h3 class="font-bold text-lg">${escapeHtml(idea.author)}</h3>
              <p class="text-gray-400">${escapeHtml(idea.specialty || 'ุนุถู')}</p>
              <p class="text-sm text-gray-500">${formatDate(idea.createdAt)}</p>
            </div>
          </div>

          <div class="prose prose-invert max-w-none">
            <div class="text-lg text-gray-300 leading-relaxed whitespace-pre-wrap">${escapeHtml(idea.content)}</div>
          </div>

          <div class="flex items-center gap-4 pt-6 border-t border-white/10">
            <button onclick="toggleLike('${idea.__backendId}')" class="flex items-center gap-2 px-4 py-2 rounded-xl ${hasLiked ? 'bg-pink-600' : 'bg-white/10'} hover:bg-pink-600/80 transition">
              <span>โค๏ธ</span>
              <span>${likeCount}</span>
              <span class="text-sm">${hasLiked ? 'ุฃุนุฌุจูู' : 'ุฅุนุฌุงุจ'}</span>
            </button>
            <div class="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/10">
              <span>๐๏ธ</span>
              <span>${viewCount}</span>
              <span class="text-sm">ูุดุงูุฏุฉ</span>
            </div>
            <div class="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/10">
              <span>๐ฌ</span>
              <span>${comments.length}</span>
              <span class="text-sm">ุชุนููู</span>
            </div>
          </div>

          <div class="pt-6 border-t border-white/10">
            <h3 class="text-xl font-bold mb-4">ุงูุชุนูููุงุช (${comments.length})</h3>
            
            <div class="mb-6 bg-white/5 rounded-xl p-4">
              <textarea id="comment-input" rows="3" 
                class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500 resize-none"
                placeholder="ุงูุชุจ ุชุนูููู ููุง..."></textarea>
              <button onclick="addComment('${idea.__backendId}')" id="add-comment-btn"
                class="mt-3 px-6 py-2 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 hover:opacity-90 transition">
                ๐ฌ ุฅุฑุณุงู
              </button>
            </div>
            
            <div class="space-y-4">
              ${comments.length === 0 ? '<p class="text-gray-400 text-center py-4">ูุง ุชูุฌุฏ ุชุนูููุงุช ุจุนุฏ. ูู ุฃูู ูู ูุนูู!</p>' : ''}
              ${comments.map(comment => `
                <div class="bg-white/5 rounded-xl p-4">
                  <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-pink-600 to-orange-500 flex items-center justify-center">
                      ${comment.role === 'admin' ? '๐' : '๐ก'}
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center gap-2 mb-1">
                        <span class="font-bold">${escapeHtml(comment.author)}</span>
                        <span class="text-xs text-gray-500">${formatDate(comment.createdAt)}</span>
                      </div>
                      <p class="text-gray-300">${escapeHtml(comment.content)}</p>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;

      document.querySelectorAll('#main-content > section:not(#idea-detail-section)').forEach(s => s.classList.add('hidden'));
      document.getElementById('idea-detail-section').classList.remove('hidden');
    }

    function closeIdeaDetail() {
      document.getElementById('idea-detail-section').classList.add('hidden');
      const activeSidebarBtn = document.querySelector('.sidebar-item.active');
      if (activeSidebarBtn) {
        const section = activeSidebarBtn.getAttribute('data-section');
        document.getElementById(`${section}-section`).classList.remove('hidden');
      } else {
        document.getElementById('home-section').classList.remove('hidden');
      }
    }

    // Initialize
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bbeea4d17b54ed3',t:'MTc2ODA3Njg0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
